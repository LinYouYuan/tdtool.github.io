{"version":3,"sources":["../../src/util/load-config.js"],"names":["module","exports","config","entry","options","target","output","path","resolve","process","cwd","dist","publicPath","nil","libraryTarget","library","moduleName","umdNamedDefine","optins","plugins","rules","devServer","modules","concat","define","DefinePlugin","Object","env","NODE_ENV","template","templates","Boolean","clean","__CLEAN__","alias","externals","urlLoaderLimit","filename","chunkFilename","UglifyJs","optimize","UglifyJsPlugin","sourceMap","comments","compress","screw_ie8","unused","dead_code","collapse_vars","reduce_vars","mangle","UglifyCss","LoaderOptionsPlugin","minimize","js","css","LoaderOptions","SourceMapDevTool","SourceMapDevToolPlugin","devtool","Banner","BannerPlugin","banner","raw","entryOnly","NoErrors","NoEmitOnErrorsPlugin","NoErrorsPlugin","cache","bail","ProgressBar"],"mappings":"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","file":"load-config.js","sourcesContent":["/**\n * @Author: Zhengfeng.Yao <yzf>\n * @Date:   2017-04-27 15:53:41\n * @Last modified by:   yzf\n * @Last modified time: 2017-04-27 15:53:43\n */\n\nimport path from 'path'\nimport webpack from 'webpack'\nimport ProgressBarPlugin from 'progress-bar-webpack-plugin'\n\nimport is from './is'\nimport extractCss from './extract-css'\nimport loadTemplate from './load-template'\nimport { DIST, PUBLIC_PATH, URL_LOADER_LIMIT } from './constant'\n\n/**\n * generate tdtool config by user options\n *\n * @param options [user options]\n * @return config [tdtool config]\n */\nmodule.exports = options => {\n  const config = {\n    entry: options.entry,\n    target: options.target,\n    output: {\n      path: path.resolve(process.cwd(), options.dist || DIST),\n      publicPath: is.nil(options.publicPath) ? PUBLIC_PATH : options.publicPath,\n      libraryTarget: options.libraryTarget,\n      library: options.moduleName,\n      umdNamedDefine: options.libraryTarget === 'umd' || optins.libraryTarget === 'amd'\n    },\n    plugins: {},\n    module: {\n      rules: {}\n    },\n    devServer: {},\n    resolve: {\n      modules: ['node_modules', path.resolve(process.cwd(), 'node_modules')].concat(options.modules)\n    }\n  }\n  // node env\n  config.plugins.define = new webpack.DefinePlugin(is.Object(options.env) ? Object.assign({\n    'process.env.NODE_ENV': JSON.stringify(process.env.NODE_ENV)\n  }, options.env) : {\n    'process.env.NODE_ENV': JSON.stringify(\n      is.nil(options.env) ? process.env.NODE_ENV : options.env\n    )\n  });\n  // template\n  if (options.template !== false) {\n    config.plugins.templates = loadTemplate(options.template)\n  }\n  // clean\n  if (is.Boolean(options.clean)) {\n    config.__CLEAN__ = optins.clean\n  } else {\n    config.__CLEAN__ = true\n  }\n  // alias\n  if (options.alias) {\n    config.resolve.alias = options.alias\n  }\n  // externals\n  if (options.externals) {\n    config.externals = options.externals\n  }\n  // urlLoaderLimit\n  if (options.urlLoaderLimit) {\n    config.urlLoaderLimit = options.urlLoaderLimit\n  }\n  // filename\n  config.output.filename = options.filename || '[name].js'\n  // chunkFilename\n  config.output.chunkFilename = options.chunkFilename || '[name].chunk.js'\n  // minimize\n  const UglifyJs = new webpack.optimize.UglifyJsPlugin({\n    sourceMap: Boolean(optins.sourceMap),\n    comments: false,\n    compress: {\n      screw_ie8: true,\n      unused: true,\n      dead_code: true,\n      collapse_vars: true,\n      reduce_vars: true\n    },\n    mangle: {\n      screw_ie8: true,\n    },\n    output: {\n      comments: false,\n      screw_ie8: true,\n    },\n  })\n  const UglifyCss = new webpack.LoaderOptionsPlugin({minimize: true})\n  if (is.Object(options.minimize)) {\n    if (minimize.js) {\n      config.plugins.UglifyJs = UglifyJs\n    }\n    if (minimize.css) {\n      config.plugins.LoaderOptions = UglifyCss\n    }\n  } else {\n    if (options.minimize) {\n      config.plugins.UglifyJs = UglifyJs\n      config.plugins.LoaderOptions = UglifyCss\n    }\n  }\n  // sourceMap\n  if (!!options.sourceMap) {\n    config.plugins.SourceMapDevTool = new webpack.SourceMapDevToolPlugin({filename: '[file].map'})\n    config.devtool = options.sourceMap === true ? (options.devServer === 'node' ? 'cheap-module-source-map' : 'source-map'): options.sourceMap\n    if (options.devServer === 'node') {\n      config.plugins.Banner = new webpack.BannerPlugin({\n        banner: 'require(\"source-map-support\").install();',\n        raw: true,\n        entryOnly: false,\n      })\n    }\n  }\n  // development\n  if (process.env.NODE_ENV === 'development') {\n    config.plugins.NoErrors = webpack.NoEmitOnErrorsPlugin ? new webpack.NoEmitOnErrorsPlugin() : new webpack.NoErrorsPlugin()\n    config.cache = true\n  }\n  // development\n  if (process.env.NODE_ENV === 'production') {\n    config.bail = true\n  }\n  // extractCss\n  extractCss(options, config)\n  // ProgressBarPlugin\n  config.plugins.ProgressBar = new ProgressBarPlugin()\n}\n"]}