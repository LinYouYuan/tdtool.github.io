{"version":3,"sources":["../../src/util/load-config.js"],"names":["module","exports","config","entry","options","target","output","path","resolve","process","cwd","dist","publicPath","nil","libraryTarget","library","moduleName","umdNamedDefine","plugins","rules","devServer","modules","__dirname","concat","define","DefinePlugin","Object","env","NODE_ENV","template","templates","alias","externals","filename","chunkFilename","UglifyJs","optimize","UglifyJsPlugin","sourceMap","Boolean","comments","compress","screw_ie8","unused","dead_code","collapse_vars","reduce_vars","mangle","UglifyCss","LoaderOptionsPlugin","minimize","js","css","LoaderOptions","SourceMapDevTool","SourceMapDevToolPlugin","devtool","Banner","BannerPlugin","banner","raw","entryOnly","NoErrors","NoEmitOnErrorsPlugin","NoErrorsPlugin","cache","bail","ProgressBar"],"mappings":"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","file":"load-config.js","sourcesContent":["/**\n * @Author: Zhengfeng.Yao <yzf>\n * @Date:   2017-04-27 15:53:41\n * @Last modified by:   yzf\n * @Last modified time: 2017-04-27 15:53:43\n */\n\nimport path from 'path'\nimport webpack from 'webpack'\nimport CleanWebpackPlugin from 'clean-webpack-plugin'\nimport ProgressBarPlugin from 'progress-bar-webpack-plugin'\n\nimport is from './is'\nimport loadTemplate from './load-template'\nimport { DIST, PUBLIC_PATH } from './constant'\n\n/**\n * generate tdtool config by user options\n *\n * @param options [user options]\n * @return config [tdtool config]\n */\nmodule.exports = options => {\n  const config = {\n    entry: options.entry,\n    target: options.target,\n    output: {\n      path: path.resolve(process.cwd(), options.dist || DIST),\n      publicPath: is.nil(options.publicPath) ? PUBLIC_PATH : options.publicPath,\n      libraryTarget: options.target === 'node' ? 'commonjs2' : options.libraryTarget,\n      library: options.moduleName,\n      umdNamedDefine: options.libraryTarget === 'umd' || options.libraryTarget === 'amd'\n    },\n    plugins: {},\n    module: {\n      rules: {}\n    },\n    devServer: {},\n    resolve: {\n      modules: ['node_modules', path.resolve(process.cwd(), 'node_modules'), path.resolve(__dirname, '../../node_modules')].concat(options.modules)\n    }\n  }\n  // node env\n  config.plugins.define = new webpack.DefinePlugin(is.Object(options.env) ? Object.assign({\n    'process.env.NODE_ENV': JSON.stringify(process.env.NODE_ENV)\n  }, options.env) : {\n    'process.env.NODE_ENV': JSON.stringify(\n      is.nil(options.env) ? process.env.NODE_ENV : options.env\n    )\n  });\n  // template\n  if (options.template !== false) {\n    config.plugins.templates = loadTemplate(options.template)\n  }\n  // alias\n  if (options.alias) {\n    config.resolve.alias = options.alias\n  }\n  // externals\n  if (options.externals) {\n    config.externals = options.externals\n  }\n  // filename\n  config.output.filename = options.filename || '[name].js'\n  // chunkFilename\n  config.output.chunkFilename = options.chunkFilename || '[name].chunk.js'\n  // minimize\n  const UglifyJs = new webpack.optimize.UglifyJsPlugin({\n    sourceMap: Boolean(options.sourceMap),\n    comments: false,\n    compress: {\n      screw_ie8: true,\n      unused: true,\n      dead_code: true,\n      collapse_vars: true,\n      reduce_vars: true\n    },\n    mangle: {\n      screw_ie8: true,\n    },\n    output: {\n      comments: false,\n      screw_ie8: true,\n    },\n  })\n  const UglifyCss = new webpack.LoaderOptionsPlugin({minimize: true})\n  if (is.Object(options.minimize)) {\n    if (options.minimize.js) {\n      config.plugins.UglifyJs = UglifyJs\n    }\n    if (options.minimize.css) {\n      config.plugins.LoaderOptions = UglifyCss\n    }\n  } else {\n    if (options.minimize) {\n      config.plugins.UglifyJs = UglifyJs\n      config.plugins.LoaderOptions = UglifyCss\n    }\n  }\n  // sourceMap\n  if (!!options.sourceMap) {\n    config.plugins.SourceMapDevTool = new webpack.SourceMapDevToolPlugin({filename: '[file].map'})\n    config.devtool = options.sourceMap === true ? (options.target === 'node' ? 'cheap-module-source-map' : 'source-map'): options.sourceMap\n    if (options.target === 'node') {\n      config.plugins.Banner = new webpack.BannerPlugin({\n        banner: 'require(\"source-map-support\").install();',\n        raw: true,\n        entryOnly: false,\n      })\n    }\n  }\n  // development\n  if (process.env.NODE_ENV === 'development') {\n    config.plugins.NoErrors = webpack.NoEmitOnErrorsPlugin ? new webpack.NoEmitOnErrorsPlugin() : new webpack.NoErrorsPlugin()\n    config.cache = true\n  }\n  // development\n  if (process.env.NODE_ENV === 'production') {\n    config.bail = true\n  }\n  // ProgressBarPlugin\n  config.plugins.ProgressBar = new ProgressBarPlugin()\n\n  return config\n}\n"]}